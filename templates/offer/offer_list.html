{% extends "base.html" %}
{% load formatting %}

{% block content %}
<div class="container my-5">
  <h2 class="fw-bold mb-4 text-center text-white">Your Purchase Offers</h2>

  {% if offers %}
    <div class="row g-4">
      {% for offer in offers %}
        <div class="col-md-6 col-lg-4">
          <div class="card h-100 shadow-sm">
            <div class="card-body">
              <h5 class="card-title">
                <a href="{% url 'property-detail' offer.property.id %}" class="text-decoration-none text-dark">
                  {{ offer.property.street_name }}, {{ offer.property.city }}
                </a>
              </h5>
                <p class="mb-1"><strong>Property Price:</strong> {{ offer.property.price|intdot }} kr.</p>
                <p class="mb-1"><strong>Offer Date:</strong> {{ offer.offer_date|date:"Y-m-d" }}</p>
                <p class="mb-1"><strong>Expires:</strong> {{ offer.expiration_date|date:"Y-m-d" }}</p>

              <p class="mb-1">
                <strong>Status:</strong>
                <span class="badge
                  {% if offer.status == 'pending' %}bg-warning text-dark
                  {% elif offer.status == 'rejected' %}bg-danger
                  {% elif offer.status == 'accepted' or offer.status == 'contingent' %}bg-success
                  {% endif %}">
                  {{ offer.status|title }}
                </span>
              </p>

                <p class="mb-1 fst-italic"><strong>Seller:</strong> {{ offer.property.seller.get_full_name }}</p>
                <p class="mb-1"><strong>Your Offer Amount:</strong> {{ offer.amount|intdot }} kr.</p>

              <div class="text-center">
                <a href="{% url 'property-detail' offer.property.id %}" class="btn btn-outline-primary btn-sm mt-2 rounded-pill">
                  View Property
                </a>
              </div>

              <div class="text-center">
                {% if offer.status == 'accepted' or offer.status == 'contingent' %}
                  <div class="d-inline-block mt-2">
                    <a href="{% url 'finalize-offer' offer.id %}" class="offer-btn bg-success">
                      Finalize Offer
                    </a>
                  </div>
                {% elif offer.status == 'rejected' %}
                  <div class="d-inline-block mt-2">
                    <form method="POST" action="{% url 'delete-offer' offer.id %}" class="m-0 p-0">
                      {% csrf_token %}
                      <button type="submit" class="offer-btn bg-danger">Delete Offer</button>
                    </form>
                  </div>
                {% elif offer.status == 'pending' %}
                  <div class="d-inline-block mt-2">
                    <a href="{% url 'resubmit-offer' offer.id %}" class="offer-btn offer-btn-yellow">
                      Resubmit Offer
                    </a>
                  </div>
                {% endif %}
              </div>

            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="text-muted text-center mt-4">You haven't submitted any purchase offers yet.</p>
  {% endif %}
</div>
{% endblock %}
